<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detector Multilíngue - Conteúdo Humano vs IA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        /* Mantenha todo o CSS anterior */
    </style>
</head>
<body>
    <!-- Mantenha toda a estrutura HTML anterior -->
    
    <script>
        // PADRÕES FORTES DE IA - ATUALIZADOS E MELHORADOS
        const universalAIPatterns = [
            // Padrões estruturais de organização (comuns em IA)
            {
                pattern: /\b(?:\d+\.\s*\d*\.?\s*[A-Z][^.!?]{10,50}[.!?])/gi,
                weight: 25,
                description: "Estrutura de tópicos excessivamente numerada e organizada"
            },
            {
                pattern: /\b(?:This paper|This article|Este artículo|Este artigo)\s+(?:aims to|argues for|postula que|defende que)\s+(?:a|an|the|um|uma)\s+(?:comprehensive|robust|tripartite|integral|robusto|tripartido)\s+(?:model|framework|modelo|marco)/gi,
                weight: 30,
                description: "Declaração de objetivo acadêmico excessivamente estruturada"
            },
            {
                pattern: /\b(?:Through an|A través de un|Através de uma)\s+(?:extensive|comprehensive|completa|extensa)\s+(?:literature review|revisión de la literatura|revisão da literatura)/gi,
                weight: 28,
                description: "Menção genérica a revisão de literatura"
            },
            {
                pattern: /\b(?:The discussion concludes|La discusión concluye|A discussão conclui)\s+that\s+(?:fostering|promover|fomentar)\s+(?:a|an|the|um|uma)\s+(?:holistic|comprehensive|integral|holística)/gi,
                weight: 26,
                description: "Conclusão padronizada com linguagem genérica"
            },
            // Padrões de transição formulaicos
            {
                pattern: /\b(?:Therefore|Thus|Hence|Por lo tanto|Por conseguinte|Portanto),\s+(?:this\s+(?:paper|article|artículo|artigo))\s+(?:aims to|seeks to|procura|busca)/gi,
                weight: 22,
                description: "Transição formulaica para objetivo"
            },
            {
                pattern: /\b(?:In conclusion|En conclusión|Em conclusão),\s+(?:technological literacy|la alfabetización tecnológica|a alfabetização tecnológica)\s+(?:is|es|é)\s+(?:not|no)\s+(?:an optional|una opcional|uma opcional)/gi,
                weight: 24,
                description: "Conclusão genérica com estrutura previsível"
            },
            // Padrões de citação e referência
            {
                pattern: /\b(?:As\s+(?:Freire|Papert|Buckingham|Postman)\s+(?:himself|himself|mismo|mesmo)\s+(?:stated|argued|afirmó|afirmou),?/gi,
                weight: 20,
                description: "Citação de autor com estrutura padronizada"
            },
            {
                pattern: /\b(?:This aligns with|Esto se alinea con|Isso se alinha com)\s+the work of\s+(?:contemporary|modern|contemporáneos|modernos)\s+scholars/gi,
                weight: 18,
                description: "Menção genérica a alinhamento teórico"
            },
            // Padrões de definição e estruturação
            {
                pattern: /\b(?:This framework is composed of|Este marco está compuesto por|Este marco é composto por):\s*\d\./gi,
                weight: 27,
                description: "Definição de framework com estrutura numérica explícita"
            },
            {
                pattern: /\b(?:The tripartite framework|El marco tripartito|O marco tripartido)\s+(?:proposed|propuesto|proposto).*?encompasses?.*?dimensions?/gi,
                weight: 29,
                description: "Menção repetitiva a estrutura tripartite"
            }
        ];

        // PADRÕES DE IA EM INGLÊS - ESPECÍFICOS
        const englishAIPatterns = [
            {
                pattern: /\b(?:moving beyond|going beyond)\s+simplistic notions of\s+\w+/gi,
                weight: 23,
                description: "Frase introdutória genérica de superação"
            },
            {
                pattern: /\b(?:This (?:paper|article) (?:has argued|posits|postulates) that\s+)/gi,
                weight: 21,
                description: "Declaração de argumento padronizada"
            },
            {
                pattern: /\b(?:The path forward requires|The way forward requires)\s+a concerted effort/gi,
                weight: 25,
                description: "Recomendação genérica de ação futura"
            },
            {
                pattern: /\b(?:It is no longer enough to|Ya no es suficiente|Já não é suficiente)/gi,
                weight: 19,
                description: "Estrutura de superação padronizada"
            },
            {
                pattern: /\b(?:A (?:highly|very) influential model is (?:the one )?proposed by\s+)/gi,
                weight: 22,
                description: "Menção a modelos de forma genérica"
            }
        ];

        // PADRÕES DE IA EM ESPANHOL - ESPECÍFICOS
        const spanishAIPatterns = [
            {
                pattern: /\b(?:Yendo más allá de|Ir más allá de)\s+las? (?:nociones|ideas)\s+simplistas/gi,
                weight: 23,
                description: "Frase introdutória genérica em espanhol"
            },
            {
                pattern: /\b(?:Este artículo (?:aboga por|postula|defiende)\s+un\s+(?:modelo|marco)\s+(?:integral|robusto|tripartito))/gi,
                weight: 26,
                description: "Declaração de objetivo padronizada em espanhol"
            },
            {
                pattern: /\b(?:A través de una|Mediante una)\s+(?:extensa|exhaustiva|completa)\s+revisión de la literatura/gi,
                weight: 24,
                description: "Menção genérica a revisão de literatura em espanhol"
            },
            {
                pattern: /\b(?:La discusión concluye que)\s+(?:fomentar|promover)\s+una/gi,
                weight: 25,
                description: "Conclusão padronizada em espanhol"
            },
            {
                pattern: /\b(?:Por lo tanto, este artículo (?:tiene como objetivo|busca|procura))/gi,
                weight: 22,
                description: "Transição formulaica em espanhol"
            }
        ];

        // PADRÕES HUMANOS FORTES - ATUALIZADOS
        const universalHumanPatterns = [
            {
                pattern: /[^.!?]{150,}[.!?]/g,
                weight: 15,
                description: "Frases muito longas e complexas (mais comum em humanos)"
            },
            {
                pattern: /(?:"[^"]{50,}"|'[^']{50,}')/g,
                weight: 18,
                description: "Citações longas e específicas"
            },
            {
                pattern: /\b(?:curiously|interestingly|surprisingly|curiosamente|sorprendentemente)\b/gi,
                weight: 20,
                description: "Expressões de descoberta ou surpresa"
            },
            {
                pattern: /\b(?:I (?:have|had) (?:observed|noticed|found)|He (?:observed|noticed|found)|Observ(?:é|amos)|Not(?:é|amos))\b/gi,
                weight: 25,
                description: "Menção a observações pessoais"
            },
            {
                pattern: /\b(?:In my (?:experience|view)|En mi (?:experiencia|opinión)|Na minha (?:experiência|opinião))\b/gi,
                weight: 30,
                description: "Expressões de opinião pessoal explícita"
            },
            {
                pattern: /\b(?:however, it is worth noting|sin embargo, vale la pena señalar|contudo, vale a pena notar)\b/gi,
                weight: 16,
                description: "Qualificações e nuances típicas de humanos"
            },
            {
                pattern: /[!?]{2,}|…/g,
                weight: 12,
                description: "Pontuação expressiva e hesitações"
            },
            {
                pattern: /\b(?:paradoxically|ironically|paradójicamente|irónicamente)\b/gi,
                weight: 18,
                description: "Expressões de contradição ou ironia"
            }
        ];

        // FUNÇÃO DE DETECÇÃO DE PADRÕES MELHORADA
        function detectAIPatterns(text, language) {
            let totalScore = 0;
            const detectedPatterns = [];
            
            // Padrões universais de IA
            universalAIPatterns.forEach(patternObj => {
                const matches = text.match(patternObj.pattern);
                if (matches && matches.length > 0) {
                    const score = Math.min(matches.length * patternObj.weight, 100);
                    totalScore += score;
                    
                    detectedPatterns.push({
                        pattern: patternObj.pattern.source.substring(0, 50) + '...',
                        matches: matches.length,
                        description: patternObj.description,
                        examples: matches.slice(0, 3),
                        score: score
                    });
                }
            });
            
            // Padrões específicos por idioma
            if (language === 'en' && englishAIPatterns) {
                englishAIPatterns.forEach(patternObj => {
                    const matches = text.match(patternObj.pattern);
                    if (matches && matches.length > 0) {
                        const score = Math.min(matches.length * patternObj.weight, 100);
                        totalScore += score;
                        
                        detectedPatterns.push({
                            pattern: patternObj.pattern.source.substring(0, 50) + '...',
                            matches: matches.length,
                            description: patternObj.description,
                            examples: matches.slice(0, 3),
                            score: score
                        });
                    }
                });
            }
            
            if (language === 'es' && spanishAIPatterns) {
                spanishAIPatterns.forEach(patternObj => {
                    const matches = text.match(patternObj.pattern);
                    if (matches && matches.length > 0) {
                        const score = Math.min(matches.length * patternObj.weight, 100);
                        totalScore += score;
                        
                        detectedPatterns.push({
                            pattern: patternObj.pattern.source.substring(0, 50) + '...',
                            matches: matches.length,
                            description: patternObj.description,
                            examples: matches.slice(0, 3),
                            score: score
                        });
                    }
                });
            }
            
            // Análise estrutural adicional
            const structuralScore = analyzeStructuralPatterns(text, language);
            totalScore += structuralScore;
            
            return {
                patterns: detectedPatterns,
                totalScore: totalScore,
                normalizedScore: Math.min(totalScore / 4, 85), // Ajustado para ser mais sensível
                structuralScore: structuralScore
            };
        }

        // ANÁLISE ESTRUTURAL AVANÇADA
        function analyzeStructuralPatterns(text, language) {
            let structuralScore = 0;
            
            // Contar seções numeradas
            const numberedSections = (text.match(/\b\d+\.\s*\d*\.?\s*[A-Z]/gi) || []).length;
            if (numberedSections > 3) structuralScore += numberedSections * 3;
            
            // Verificar estrutura de referências
            const referencePattern = /(?:References?|Referencias?|Referências?)\s*\n\s*(?:[A-Z][^.!?]{10,50}[.!?]\s*\n)*/gi;
            const hasStructuredReferences = referencePattern.test(text);
            if (hasStructuredReferences) structuralScore += 15;
            
            // Verificar transições formulaicas
            const transitionWords = {
                'en': ['therefore', 'thus', 'hence', 'consequently', 'accordingly', 'furthermore', 'moreover'],
                'es': ['por lo tanto', 'así pues', 'en consecuencia', 'por consiguiente', 'además', 'asimismo'],
                'pt': ['portanto', 'assim', 'consequentemente', 'por conseguinte', 'além disso', 'ademais']
            };
            
            const transitions = transitionWords[language] || transitionWords['en'];
            let transitionCount = 0;
            transitions.forEach(word => {
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                transitionCount += (text.match(regex) || []).length;
            });
            
            if (transitionCount > 5) structuralScore += Math.min(transitionCount * 2, 20);
            
            // Verificar repetição de termos acadêmicos
            const academicTerms = ['framework', 'model', 'paradigm', 'dimension', 'marco', 'modelo', 'paradigma', 'dimensión'];
            let termRepetition = 0;
            academicTerms.forEach(term => {
                const regex = new RegExp(`\\b${term}\\b`, 'gi');
                const count = (text.match(regex) || []).length;
                if (count > 3) termRepetition += (count - 3) * 2;
            });
            
            structuralScore += Math.min(termRepetition, 15);
            
            return structuralScore;
        }

        // ALGORITMO PRINCIPAL ATUALIZADO
        async function advancedAnalyzeContent(text, contentType) {
            const selectedLanguage = document.getElementById('languageSelect').value;
            const detectedLanguage = selectedLanguage === 'auto' ? detectLanguage(text) : selectedLanguage;
            
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const wordCount = text.split(/\s+/).length;
            const sentenceCount = text.split(/[.!?]+/).length - 1;
            const paragraphCount = text.split(/\n\s*\n/).length;
            
            const lexicalRichness = calculateLexicalRichness(text);
            const sentenceVariety = analyzeSentenceVariety(text);
            const aiPatternAnalysis = detectAIPatterns(text, detectedLanguage);
            const humanPatternAnalysis = detectHumanPatterns(text, detectedLanguage);
            
            // CÁLCULO DO SCORE - MAIS RIGOROSO PARA IA
            let humanScore = 50;
            
            // PENALIDADES FORTES PARA PADRÕES DE IA
            humanScore -= aiPatternAnalysis.normalizedScore;
            humanScore -= aiPatternAnalysis.structuralScore;
            
            // BÔNUS MODERADO PARA PADRÕES HUMANOS
            humanScore += humanPatternAnalysis.normalizedScore * 0.7; // Reduzido o bônus
            
            // ANÁLISE DE COMPLEXIDADE
            if (lexicalRichness < 15) humanScore -= 10;
            if (sentenceVariety < 0.3) humanScore -= 8;
            
            // TEXTOS MUITO ESTRUTURADOS SÃO PENALIZADOS
            const structureRatio = (aiPatternAnalysis.structuralScore / 50);
            if (structureRatio > 0.6) humanScore -= 15;
            
            // LIMITES MAIS RESTRITIVOS
            const humanProbability = Math.max(5, Math.min(85, humanScore));
            const confidence = calculateConfidence(text.length, humanPatternAnalysis.normalizedScore, aiPatternAnalysis.normalizedScore);
            
            const textHighlights = generateTextHighlights(text, aiPatternAnalysis, humanPatternAnalysis);
            const suggestions = generateSuggestions(humanProbability, aiPatternAnalysis, humanPatternAnalysis, detectedLanguage);
            
            return {
                humanProbability,
                aiProbability: 100 - humanProbability,
                analyzedText: text,
                wordCount,
                sentenceCount,
                paragraphCount,
                contentType,
                detectedLanguage,
                confidence,
                advancedMetrics: {
                    aiPatternScore: Math.round(aiPatternAnalysis.normalizedScore),
                    humanPatternScore: Math.round(humanPatternAnalysis.normalizedScore),
                    structuralScore: Math.round(aiPatternAnalysis.structuralScore),
                    lexicalRichness: Math.round(lexicalRichness),
                    sentenceVariety: Math.round(sentenceVariety * 100) / 100,
                    strongAIPatterns: aiPatternAnalysis.patterns.length,
                    strongHumanPatterns: humanPatternAnalysis.patterns.length
                },
                aiPatternAnalysis: aiPatternAnalysis,
                humanPatternAnalysis: humanPatternAnalysis,
                textHighlights,
                suggestions,
                detailedExplanation: generateDetailedExplanation({
                    humanProbability, 
                    aiPatternScore: aiPatternAnalysis.normalizedScore,
                    humanPatternScore: humanPatternAnalysis.normalizedScore,
                    structuralScore: aiPatternAnalysis.structuralScore,
                    lexicalRichness,
                    sentenceVariety,
                    aiPatterns: aiPatternAnalysis.patterns,
                    humanPatterns: humanPatternAnalysis.patterns,
                    language: detectedLanguage
                })
            };
        }

        // ... (mantenha as outras funções do código anterior)

    </script>
</body>
</html>
